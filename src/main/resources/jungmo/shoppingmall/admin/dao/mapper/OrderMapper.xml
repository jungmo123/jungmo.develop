<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd"> 
<mapper namespace="jungmo.shoppingmall.admin.order.dao.mapper.OrderMapper">
	<select id = "getOrders" resultMap = "purMap">
      select purchases.ord_num,purchases.god_num,ord_type,ord_date,god_amount,god_name,god_sellingprice,users.user_id,user_name
      from purchases join goods
      on (purchases.god_num = goods.god_num)
      join orders
      on (purchases.ord_num = orders.ord_num)
      join users
      on (orders.user_id = users.user_id)
      order by purchases.ord_num
	</select>
	
	<update id = "dvModify" parameterType = "hashmap">
		update orders
		<foreach item="tp" collection = "type">
			set ord_type = #{tp}
		</foreach>
		where ord_num in 
		<foreach item = "ls" collection = "list" index = "index" open="(" separator="," close=")">
			#{ls}
		</foreach>
	</update>
	
	<resultMap id = "purMap" type = "pur">
		<id property = "ordNum" column = "ord_num" />
		<association property = "order" resultMap = "getOrder" />
		<collection property = "goods" columnPrefix = "god_" resultMap="godMap" />
	</resultMap>
	
	<resultMap id = "godMap" type = "god">
		<id property = "godNum" column = "num" />
		<result property = "godName" column = "name" />
		<result property = "godAmount" column = "amount" />
		<result property = "godSellingPrice" column = "sellingprice" />
	</resultMap>
	 
	<resultMap id = "getOrder" type = "order">
		<result property = "ordDate" column = "ord_date" />
		<result property = "ordType" column = "ord_type" />
		<association property = "user" resultMap="getUser" />
	</resultMap>
	
	<resultMap id = "getUser" type = "user">
		<result property = "userId" column = "user_id" />
		<result property = "userName" column = "user_name" />
	</resultMap>
</mapper>